<!-- Topics -->
<p-toast></p-toast>
<div>
  <div
    class="flex flex-col items-center justify-start m-0 z-10"
    *ngFor="let topic of topics; let i = index"
  >
    <div class="m-0 w-full mx-2 pb-2 transition duration-300 ease-in-out">
      <div class="flex flex-row items-center justify-between mx-0 my-1.5">
        <div class="flex flex-row items-center">
          <app-iconbutton
            icon="bx-chevron-down"
            color="text-black"
            (click)="onSelectTopic(topic)"
          ></app-iconbutton>
          <p id="{{ topic._id }}" class="text-lg font-semibold" #{{topic._id}}>
            {{ topic.name }}
          </p>
          <div hidden="true" id="{{ topic._id }}-button">
            <button
              (click)="selectedTopic = topic; onRenameConfirmedTopic(topic._id)"
              class="confirm-button"
            >
              confirm
            </button>
          </div>
        </div>
        <p-menu
          #menu
          id="config_menu"
          [model]="topicOptions"
          [popup]="true"
        ></p-menu>
        <app-iconbutton
          icon="bx-dots-vertical-rounded"
          color="text-black"
          (click)="selectedTopic = topic; menu.toggle($event)"
        ></app-iconbutton>
      </div>

      <div
        class="pl-7 py-1 hover:bg-white transition-all"
        [class.active]="channel._id == activeChannel"
        [class.channel-bold]="getChannelNotification(channel._id).news > 0"
        [class.has-visited]="visitedChannel.includes(channel._id)"
        *ngFor="let channel of topic.channels; let i = index"
        [attr.data-index]="i"
      >
        <div
          class="flex flex-row items-center justify-between"
          (click)="handleHighlight(getChannelNotification(channel._id).replies)"
        >
          <p
            id="{{ channel._id }}"
            (dblclick)="onDblClickRenameChannel(channel._id)"
            class="cursor-pointer w-full"
            (click)="selectChannel(channel._id, channel.courseId)"
          >
            # {{ channel.name }}
          </p>
          <p-badge
            *ngIf="
              getChannelNotification(channel._id).replies.length.toString() !==
                '0' && !visitedChannel.includes(channel._id)
            "
            class="update-indicator"
            [value]="
              getChannelNotification(channel._id).replies.length.toString()
            "
          ></p-badge>

          <div hidden="true" id="{{ channel._id }}-button">
            <button
              (click)="
                selectedChannel = channel; onRenameConfirmedChannel(channel._id)
              "
              class="confirm-button"
            >
              confirm
            </button>
          </div>
          <app-iconbutton
            icon="bx-dots-vertical-rounded"
            color="text-black"
            (click)="selectedChannel = channel; menu.toggle($event)"
          ></app-iconbutton>
          <p-menu
            #menu
            id="config_menu"
            [model]="channelsOptions"
            [popup]="true"
          ></p-menu>
        </div>
      </div>

      <div
        class="pl-5 py-1 hover:bg-white transition-all"
        (click)="onAddNewChannelClicked(topic)"
      >
        <div class="flex flex-row items-center">
          <app-iconbutton
            icon="bx-plus"
            color="text-black"
            (onClick)="showMenu()"
          ></app-iconbutton>
          <p class="cursor-pointer w-full italic font-semibold">Add channel</p>
        </div>
      </div>
    </div>
  </div>
</div>
<app-add-channel
  [displayAddChannelDialogue]="displayAddChannelDialogue"
  (onCloseAddChannelDialogue)="toggleAddNewChannelClicked($event)"
></app-add-channel>
